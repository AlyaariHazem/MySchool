
<div id="id01" [attr.dir]="dir$ | async" class="modal-container">
  <div class="modal-content">
    <h2 class="school">{{ 'student.title' | translate }}</h2>
    <div class="container">
      <div class="tabcontent">
        <div [ngClass]="{'col-4':(dir$ | async)==='rtl','col-4En':(dir$ | async)==='ltr'}">
          <div class="view-toggle-buttons">
            <button 
              type="button"
              class="view-toggle-btn"
              [class.active]="showCulomn"
              (click)="showStudentCulomn()"
              pTooltip="عرض كجدول" 
              showDelay="200" 
              hideDelay="300">
              <i class="pi pi-bars"></i>
            </button>
            <button 
              type="button"
              class="view-toggle-btn"
              [class.active]="showGrid"
              (click)="showStudentGrid()"
              pTooltip="عرض كبطاقات" 
              showDelay="200" 
              hideDelay="300">
              <i class="pi pi-th-large"></i>
            </button>
          </div>
        </div>
        <!-- First Dropdown -->
        <!-- <form [formGroup]="form" [style]="hiddenFrom? 'display:none': 'display:flex'"
        [ngClass]="{'formEn': (dir$ | async) === 'ltr', 'form': (dir$ | async) !== 'ltr'}">
          <div class="group3">
            <p-select [options]="" optionValue="classID" [checkmark]="true" optionLabel="className" [editable]="true"
              [showClear]="true" placeholder="إختار طالب" />

            <p-select [options]="" optionValue="classID" [checkmark]="true" optionLabel="className" [editable]="true"
              [showClear]="true" placeholder="إختار المرحلة" />

            <p-select [options]="" optionValue="classID" [checkmark]="true" optionLabel="className" [editable]="true"
              [showClear]="true" placeholder="إختار الصف" />
          </div>
        </form> -->

        <p-button label="تصدير" variant="outlined" severity="success" (click)="openDialog()"
          [ngClass]="{'add':(dir$ | async)==='rtl','addEn':(dir$ | async)==='ltr','index':true}" label="إضافة طالب+" />

        @if (showGrid) {
        <div class="students-grid-container">
          <div class="header-section" *ngIf="paginatedStudents.length > 0">
            <div class="stats-badge">
              <i class="bi bi-people-fill"></i>
              <span class="badge-text">إجمالي الطلاب: {{totalRecords}}</span>
            </div>
          </div>
          
          <div class="group group2">
            @for (student of paginatedStudents; track $index) {
            <div class="form-control">
              <p-card class="responsive-card student-card">
                <ng-template pTemplate="header">
                  <div class="card-header-wrapper">
                    <img 
                      alt="Student" 
                      class="student-image" 
                      [src]="student.photoUrl || './../../../../../assets/img/user.jpg'" 
                      (error)="handleImageError($event)" />
                    <div class="student-id-badge">
                      <i class="bi bi-person-badge"></i>
                      <span>#{{student.studentID}}</span>
                    </div>
                  </div>
                </ng-template>
                
                <div class="card-content">
                  <div class="student-name">
                    <i class="bi bi-person-fill name-icon"></i>
                    <span class="name-text">
                      {{student.fullName.firstName +" "+ student.fullName.middleName+" "+ student.fullName.lastName}}
                    </span>
                  </div>
                  
                  <div class="info-section">
                    <div class="info-row">
                      <span class="info-label">
                        <i class="bi bi-book-fill"></i>
                        الصف:
                      </span>
                      <span class="info-value">{{student.className || 'غير محدد'}}</span>
                    </div>
                    
                    <div class="info-row">
                      <span class="info-label">
                        <i class="bi bi-layers-fill"></i>
                        المرحلة:
                      </span>
                      <span class="info-value">{{student.stageName || 'غير محدد'}}</span>
                    </div>
                    
                    <div class="info-row">
                      <span class="info-label">
                        <i class="bi bi-gender-ambiguous"></i>
                        النوع:
                      </span>
                      <span class="info-value gender-badge" [class.male]="student.gender === 'Male'" [class.female]="student.gender !== 'Male'">
                        {{student.gender == "Male" ? "ذكر" : "أنثى"}}
                      </span>
                    </div>
                    
                    @if (student.divisionName) {
                    <div class="info-row">
                      <span class="info-label">
                        <i class="bi bi-diagram-3-fill"></i>
                        الشعبة:
                      </span>
                      <span class="info-value">{{student.divisionName}}</span>
                    </div>
                    }
                  </div>
                  
                  <div class="fees-section">
                    <div class="fee-item highlight">
                      <span class="fee-label">
                        <i class="bi bi-cash-stack"></i>
                        الرسوم المطلوبة:
                      </span>
                      <span class="fee-value">{{student.fee | number}} ريال</span>
                    </div>
                  </div>
                </div>
                
                <ng-template pTemplate="footer">
                  <div class="card-footer">
                    <div class="action-buttons">
                      <p-button 
                        label="الرسوم" 
                        icon="bi bi-cash-stack" 
                        (click)="EditStudentDialog(student.studentID)" 
                        class="w-full fees-button"
                        styleClass="custom-button" />
                      @if (student.guardians.guardianID) {
                      <p-button 
                        label="ولي أمر" 
                        icon="bi bi-person-heart" 
                        (click)="EditGuardianDialog(student.guardians.guardianID)" 
                        class="w-full guardian-button"
                        styleClass="custom-button guardian" />
                      }
                    </div>
                  </div>
                </ng-template>
              </p-card>
            </div>
            } @empty {
            <div class="empty-message">
              <div class="empty-icon">
                <i class="bi bi-person-x"></i>
              </div>
              <p class="empty-text">لا يوجد طلاب متاحين</p>
              <p class="empty-subtext">لم يتم إضافة أي طالب حتى الآن</p>
            </div>
            }
          </div>
          
          <p-paginator 
            dir="ltr" 
            (onPageChange)="handlePageChange($event)" 
            [first]="paginatorService.first()"
            [rows]="paginatorService.rows()" 
            [totalRecords]="totalRecords" 
            [rowsPerPageOptions]="[8, 16, 25]" />
        </div>
        }

        @if (showCulomn) {
          <app-custom-table
            [data]="paginatedStudents"
            [columns]="tableColumns"
            [loading]="false"
            [totalRecords]="totalRecords"
            [rows]="pageSize"
            [first]="paginatorService.first()"
            [rowsPerPageOptions]="[8, 16, 25]"
            [showGlobalFilter]="false"
            [trackByField]="'studentID'"
            (pageChange)="handlePageChange($event)"
            (rowEdit)="EditStudentDialog($event)"
            (rowDelete)="deleteStudent($event)"
            (filterChange)="onFilterChange($event)">
          </app-custom-table>
        }
      </div>
    </div>
  </div>
</div>