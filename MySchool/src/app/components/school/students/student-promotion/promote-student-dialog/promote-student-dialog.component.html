<div class="promote-dialog">
  <div class="dialog-header">
    <h3>ترقية الطلاب</h3>
    <p class="subtitle">اختر القسم الجديد لكل طالب</p>
    <div class="target-year-info" *ngIf="targetYearID">
      <small style="color: #666;">السنة المستهدفة: YearID {{ targetYearID }}</small>
    </div>
    <div class="target-year-info" *ngIf="!targetYearID">
      <small style="color: #f59e0b;">⚠ السنة المستهدفة: سيتم التحديد تلقائياً من الخادم</small>
    </div>
    <div class="auto-promote-option">
      <label>
        <input 
          type="checkbox" 
          [(ngModel)]="autoPromote"
          (change)="onAutoPromoteChange()" />
        <span>ترقية تلقائية (زيادة صف واحد)</span>
      </label>
    </div>
    <div class="copy-course-plans-option">
      <label>
        <input 
          type="checkbox" 
          [(ngModel)]="copyCoursePlansFromCurrentYear" />
        <span>نسخ الخطط الدراسية من السنة السابقة (السنة الحالية للطالب)</span>
      </label>
      <small style="color: #666; display: block; margin-top: 5px; margin-left: 25px;">
        إذا تم تفعيله، سيتم نسخ الخطط الدراسية من السنة التي كان فيها الطالب إلى السنة المستهدفة
      </small>
    </div>
  </div>

  <div class="dialog-content">
    <div class="students-list">
      <div *ngFor="let student of students; let i = index" class="student-item">
        <div class="student-info">
          <strong>{{ student.studentName }}</strong>
          <span class="current-info">
            الصف الحالي: {{ student.currentClassName || '-' }} | 
            المرحلة: {{ student.currentStageName || '-' }} | 
            الشعبة: {{ student.currentDivisionName || '-' }}
          </span>
        </div>
        <div class="division-select">
          <label>القسم الجديد:</label>
          <div [formGroup]="getFormGroup(i)">
            <p-dropdown
              formControlName="newDivisionID"
              [options]="getFilteredDivisions(student)"
              optionLabel="divisionName"
              appendTo="body"
              optionValue="divisionID"
              [placeholder]="autoPromote ? 'جاري التحديد...' : 'اختر القسم'"
              [showClear]="!autoPromote"
              styleClass="w-full"
              [style]="{'width': '100%'}">
            <ng-template let-division pTemplate="item">
              <div class="division-option">
                <span>{{ division.divisionName || ('قسم ' + division.divisionID) }}</span>
                <small class="division-class">{{ division.classesName }}</small>
              </div>
            </ng-template>
            <ng-template let-division pTemplate="selectedItem">
              <div class="division-option">
                <span>{{ division.divisionName || ('قسم ' + division.divisionID) }}</span>
                <small class="division-class">{{ division.classesName }}</small>
              </div>
            </ng-template>
            </p-dropdown>
          </div>
          <small class="auto-assigned-info" *ngIf="autoPromote && getFormGroup(i).get('newDivisionID')?.value">
            ✓ تم التحديد تلقائياً: الصف التالي
          </small>
          <small class="error-info" *ngIf="autoPromote && !getFormGroup(i).get('newDivisionID')?.value">
            ⚠ لم يتم العثور على صف تالي - يرجى الاختيار يدوياً
          </small>
        </div>
      </div>
    </div>
  </div>

  <div class="dialog-footer">
    <button type="button" class="btn-cancel" (click)="onCancel()">
      إلغاء
    </button>
    <button type="button" class="btn-promote" (click)="onPromote()" [disabled]="isLoading">
      <i class="pi pi-check"></i>
      ترقية الطلاب
    </button>
  </div>
</div>
